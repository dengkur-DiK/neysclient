{"ast":null,"code":"import{QueryClient}from\"@tanstack/react-query\";/**\n * Throws an error if the fetch response is not OK.\n */async function throwIfResNotOk(res){if(!res.ok){const text=(await res.text())||res.statusText;throw new Error(\"\".concat(res.status,\": \").concat(text));}}/**\n * Generic API request helper for POST, PUT, DELETE, etc.\n */export async function apiRequest(method,endpoint,data){const apiBase=process.env.REACT_APP_API_URL||window.location.origin;const res=await fetch(\"\".concat(apiBase).concat(endpoint),{method,headers:data?{\"Content-Type\":\"application/json\"}:{},body:data?JSON.stringify(data):undefined,credentials:\"include\"});await throwIfResNotOk(res);return res;}/**\n * Behavior for handling unauthorized (401) responses\n *//**\n * Generic query function factory for use with React Query\n */export const getQueryFn=_ref=>{let{on401:unauthorizedBehavior}=_ref;return async _ref2=>{let{queryKey}=_ref2;try{const apiBase=process.env.REACT_APP_API_URL||window.location.origin;const endpoint=queryKey[0];// Cache-busting param\nconst url=new URL(\"\".concat(apiBase).concat(endpoint));url.searchParams.set(\"_ts\",Date.now().toString());const res=await fetch(url.toString(),{credentials:\"include\"});if(unauthorizedBehavior===\"returnNull\"&&res.status===401){console.warn(\"Unauthorized (401) detected — returning null.\");return null;}await throwIfResNotOk(res);const json=await res.json();console.log(\"Fetched:\",url.toString(),json);return json;}catch(error){console.error(\"Query function error:\",error);throw error;}};};/**\n * Create and export a global QueryClient with sensible defaults\n */export const queryClient=new QueryClient({defaultOptions:{queries:{queryFn:getQueryFn({on401:\"throw\"}),refetchInterval:false,refetchOnWindowFocus:false,staleTime:Infinity,retry:false},mutations:{retry:false}}});","map":{"version":3,"names":["QueryClient","throwIfResNotOk","res","ok","text","statusText","Error","concat","status","apiRequest","method","endpoint","data","apiBase","process","env","REACT_APP_API_URL","window","location","origin","fetch","headers","body","JSON","stringify","undefined","credentials","getQueryFn","_ref","on401","unauthorizedBehavior","_ref2","queryKey","url","URL","searchParams","set","Date","now","toString","console","warn","json","log","error","queryClient","defaultOptions","queries","queryFn","refetchInterval","refetchOnWindowFocus","staleTime","Infinity","retry","mutations"],"sources":["/workspaces/neysclient/src/lib/queryClient.ts"],"sourcesContent":[" import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n/**\n * Throws an error if the fetch response is not OK.\n */\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\n/**\n * Generic API request helper for POST, PUT, DELETE, etc.\n */\nexport async function apiRequest(\n  method: string,\n  endpoint: string,\n  data?: unknown\n): Promise<Response> {\n  const apiBase = process.env.REACT_APP_API_URL || window.location.origin;\n\n  const res = await fetch(`${apiBase}${endpoint}`, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\n/**\n * Behavior for handling unauthorized (401) responses\n */\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\n\n/**\n * Generic query function factory for use with React Query\n */\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> = ({ on401: unauthorizedBehavior }) => async ({ queryKey }) => {\n  try {\n    const apiBase = process.env.REACT_APP_API_URL || window.location.origin;\n    const endpoint = queryKey[0] as string;\n\n    // Cache-busting param\n    const url = new URL(`${apiBase}${endpoint}`);\n    url.searchParams.set(\"_ts\", Date.now().toString());\n\n    const res = await fetch(url.toString(), { credentials: \"include\" });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      console.warn(\"Unauthorized (401) detected — returning null.\");\n      return null as unknown as T;\n    }\n\n    await throwIfResNotOk(res);\n    const json = await res.json();\n    console.log(\"Fetched:\", url.toString(), json);\n    return json;\n  } catch (error) {\n    console.error(\"Query function error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Create and export a global QueryClient with sensible defaults\n */\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}